<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëŒ€ë³¸ ì—°ìŠµ</title>

<style>
  
body{
margin:0;
background:#1a1a1a;
color:white;
font-family:Arial;
}

/* ë°°ë„ˆ */
.banner{
width:100%;
max-width:900px;
margin:0 auto 20px auto;
border-radius:10px;
overflow:hidden;
}

.banner img{
width:100%;
height:auto;
display:block;
}

/* ì»¨í…Œì´ë„ˆ */
.container{
max-width:900px;
margin:auto;
padding:20px;
}

.section{
background:#2a2a2a;
padding:15px;
border-radius:10px;
margin-bottom:15px;
}

.scriptBox{
background:#f5f5f5;
color:black;
padding:20px;
border-radius:10px;
margin-bottom:15px;
}

textarea{
width:100%;
height:260px;
font-size:16px;
background:white;
color:black;
}

.display{
background:#111;
padding:20px;
border-radius:10px;
min-height:70px;
margin-bottom:10px;
font-size:20px;
}

.gauge{
height:14px;
background:#333;
margin-top:10px;
border-radius:6px;
overflow:hidden;
}

.gaugeBar{
height:100%;
width:100%;
background:gold;
}

.fullBtn{
width:100%;
background:#777;
color:white;
font-size:26px;
padding:18px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
}

.pauseBtn{
width:100%;
background:#c0392b;
color:white;
font-size:22px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
display:none;
}

.resumeBtn{
width:100%;
background:#27ae60;
color:white;
font-size:22px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
display:none;
}

.row{
display:flex;
gap:10px;
}

.yellowBtn{
background:gold;
color:black;
font-size:20px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
flex:1;
}

.autoOff{
background:red;
color:white;
font-size:20px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
flex:1;
}

.autoOn{
background:green;
color:white;
font-size:20px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
flex:1;
}

.small{
padding:6px 10px;
font-size:14px;
}

</style>
</head>

<body>

<div class="banner">
<img src="banner.png">
</div>

<div class="container">

<div class="section">
ì—­í• :
<input id="roleInput" placeholder="ì˜ˆ: ì¢…ëŒ€">

<br><br>

ìŒì„±:
<select id="voiceSelect">
<option value="male" selected>ë‚¨ì</option>
<option value="female">ì—¬ì</option>
</select>

ì†ë„:
<input type="range" min="0" max="5" step="0.1" value="2.5" id="speed">
<span id="speedVal">2.5</span>
</div>

<div class="scriptBox">
ëŒ€ë³¸:
<textarea id="scriptInput">
ì¢…ëŒ€: ë‹ˆ ì§€ê¸ˆ ë­í•˜ëƒ?!
í•œë³„: ì•„ë¬´ê²ƒë„ ì•ˆí–ˆëŠ”ë°ìš”
ì¢…ëŒ€: ê±°ì§“ë§í•˜ì§€ ë§ˆë¼
í•œë³„: ê±°ì§“ë§?! ë‚˜ë³´ë‹¤ ì–´ë ¤ ë³´ì´ëŠ” ê³ ë§Œ..í™•!
</textarea>
</div>

<div class="display" id="display">
&lt;ìƒëŒ€ ëŒ€ì‚¬&gt;
</div>

<div class="gauge">
<div class="gaugeBar" id="gaugeBar"></div>
</div>

<button class="fullBtn" onclick="startPractice()">
ì—°ìŠµ ì‹œì‘
</button>

<button id="pauseBtn" class="pauseBtn" onclick="pauseAuto()">
â¸ ì¼ì‹œì •ì§€
</button>

<button id="resumeBtn" class="resumeBtn" onclick="resumeAuto()">
â–¶ ë‹¤ì‹œí•˜ê¸°
</button>

<button class="fullBtn" onclick="showMyLine()">
ë‚´ ëŒ€ì‚¬ ë³´ê¸°
</button>

<div class="row">
<button class="yellowBtn" onclick="prevLine()">ì´ì „</button>
<button id="autoBtn" class="autoOff" onclick="toggleAuto()">ìë™ì—°ìŠµ OFF</button>
<button class="yellowBtn" onclick="nextLine()">ë‹¤ìŒ</button>
</div>

<br>

<button class="small" onclick="saveScript()">ğŸ’¾ ì €ì¥</button>
<button class="small" onclick="loadScript()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>

<br><br>

ì—°ìŠµíšŸìˆ˜:
<span id="count">0</span>

</div>

<script>

let lines=[];
let index=0;
let role="";
let autoMode=false;
let paused=false;

let gaugeTimer=null;
let autoTimer=null;

let remainingTime=0;
let startTime=0;

const synth=window.speechSynthesis;

function parseScript(){
role=document.getElementById("roleInput").value.trim();
lines=document.getElementById("scriptInput").value
.split("\n")
.map(l=>{
let p=l.split(":");
return { role:p[0]?.trim(), text:p[1]?.trim() };
});
}

function getVoice(){
let voices=synth.getVoices();
return voices.find(v=>v.lang.includes("ko")) || voices[0];
}

function speak(text,callback){

let utter=new SpeechSynthesisUtterance(text);
let gender=document.getElementById("voiceSelect").value;

utter.voice=getVoice();
utter.lang="ko-KR";
utter.rate=parseFloat(document.getElementById("speed").value)/2.5;
utter.pitch = gender==="male"?0.6:1.3;
utter.onend=callback;

synth.cancel();
synth.speak(utter);
}

function showLine(){

if(index<0)index=0;
if(index>=lines.length)index=0;

let line=lines[index];

if(line.role===role){
document.getElementById("display").innerText="<ë‚´ ì°¨ë¡€>";
if(autoMode && !paused) autoNext();
}else{
document.getElementById("display").innerText=line.text;
speak(line.text,()=>{
if(autoMode && !paused) autoNext();
});
}

function showMyLine() {

    for(let i = currentIndex + 1; i < script.length; i++) {
        if(script[i].role === myRole){
            document.getElementById("myDisplay").innerText =
                myRole + ": " + script[i].line;
            return;
        }
    }
}
function nextLine(){

parseScript();

do{
index++;
if(index>=lines.length) index=0;
}while(lines[index].role===role);

showLine();
}

function prevLine(){

parseScript();

do{
index--;
if(index<0) index=lines.length-1;
}while(lines[index].role===role);

showLine();
}

function startPractice(){
parseScript();
index=0;
showLine();
}

function toggleAuto(){

autoMode=!autoMode;
let btn=document.getElementById("autoBtn");

if(autoMode){
btn.className="autoOn";
btn.innerText="ìë™ì—°ìŠµ ON";
document.getElementById("pauseBtn").style.display="block";
startPractice();
}else{
stopAuto();
}

}

function pauseAuto(){

paused=true;
synth.cancel();

clearTimeout(autoTimer);
clearInterval(gaugeTimer);

remainingTime -= (Date.now()-startTime);

document.getElementById("pauseBtn").style.display="none";
document.getElementById("resumeBtn").style.display="block";

}

function resumeAuto(){

paused=false;

startGauge(remainingTime);

startTime=Date.now();

autoTimer=setTimeout(()=>{
autoNext();
},remainingTime);

document.getElementById("pauseBtn").style.display="block";
document.getElementById("resumeBtn").style.display="none";

}

function stopAuto(){

autoMode=false;
paused=false;

document.getElementById("autoBtn").className="autoOff";
document.getElementById("autoBtn").innerText="ìë™ì—°ìŠµ OFF";

document.getElementById("pauseBtn").style.display="none";
document.getElementById("resumeBtn").style.display="none";

clearTimeout(autoTimer);
clearInterval(gaugeTimer);

synth.cancel();

document.getElementById("display").innerText="<ìƒëŒ€ ëŒ€ì‚¬>";
document.getElementById("gaugeBar").style.width="100%";

}

function autoNext(){

if(!autoMode || paused) return;

index++;

if(index>=lines.length){
stopAuto();
return;
}

let line=lines[index];

if(line.role===role){

let duration=(line.text.length*80)+6000;

remainingTime=duration;
startTime=Date.now();

startGauge(duration);

autoTimer=setTimeout(()=>{
autoNext();
},duration);

}else{
showLine();
}

}

function startGauge(duration){

let bar=document.getElementById("gaugeBar");
let start=Date.now();

clearInterval(gaugeTimer);

gaugeTimer=setInterval(()=>{

if(paused) return;

let p=100-((Date.now()-start)/duration)*100;
bar.style.width=p+"%";

if(p<=0){
clearInterval(gaugeTimer);
}

},50);

}

function saveScript(){
localStorage.setItem("script",document.getElementById("scriptInput").value);
localStorage.setItem("role",document.getElementById("roleInput").value);
alert("ì €ì¥ë¨");
}

function loadScript(){
document.getElementById("scriptInput").value=localStorage.getItem("script")||"";
document.getElementById("roleInput").value=localStorage.getItem("role")||"";
alert("ë¶ˆëŸ¬ì˜´");
}

document.getElementById("speed").oninput=function(){
document.getElementById("speedVal").innerText=this.value;
}

</script>

</body>
</html>
