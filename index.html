<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëŒ€ì‚¬ ì—°ìŠµ</title>

<style>

body{
    margin:0;
    background:#1a1a1a;
    color:white;
    font-family:serif;
}

.banner{
    width:100%;
    height:160px;
    background:url("banner.jpg") center/cover no-repeat;
}

.container{
    max-width:900px;
    margin:auto;
    padding:20px;
}

.section{
    background:#2a2a2a;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
}

.scriptBox{
    background:#f5f5f5;
    color:black;
    padding:20px;
    border-radius:10px;
    margin-bottom:15px;
}

textarea{
    width:100%;
    height:260px;
    font-size:16px;
    background:white;
    color:black;
}

.display{
    background:#111;
    padding:20px;
    border-radius:10px;
    min-height:70px;
    margin-bottom:10px;
    font-size:20px;
}

.gauge{
    height:14px;
    background:#333;
    margin-top:10px;
    border-radius:6px;
    overflow:hidden;
}

.gaugeBar{
    height:100%;
    width:100%;
    background:gold;
}

.centerBox{
    text-align:center;
    margin:10px 0;
}

.grayBtn{
    background:#777;
    color:white;
    font-size:20px;
    padding:12px 30px;
    border:none;
    border-radius:8px;
    margin:5px;
    cursor:pointer;
}

.yellowBtn{
    background:gold;
    color:black;
    font-size:20px;
    padding:12px 30px;
    border:none;
    border-radius:8px;
    margin:5px;
    cursor:pointer;
}

.autoOff{
    background:red;
    color:white;
    font-size:20px;
    padding:12px 30px;
    border:none;
    border-radius:8px;
    margin:5px;
}

.autoOn{
    background:green;
    color:white;
    font-size:20px;
    padding:12px 30px;
    border:none;
    border-radius:8px;
    margin:5px;
}

.row{
    display:flex;
    justify-content:space-between;
}

.small{
    padding:6px 10px;
    font-size:14px;
}

</style>
</head>

<body>

<div class="banner"></div>

<div class="container">

<div class="section">

ì—­í• :
<input id="roleInput" placeholder="ì˜ˆ: ì¢…ëŒ€">

<br><br>

ìŒì„±:
<select id="voiceSelect">
<option value="female">ì—¬ì</option>
<option value="male">ë‚¨ì</option>
</select>

ì†ë„:
<input type="range" min="0" max="5" step="0.1" value="2.5" id="speed">
<span id="speedVal">2.5</span>

</div>

<div class="scriptBox">

ëŒ€ë³¸:
<textarea id="scriptInput">
ì¢…ëŒ€: ë‹ˆ ì§€ê¸ˆ ë­í•˜ë…¸
ëŒ€ë²ˆ: ì•„ë¬´ê²ƒë„ ì•ˆí–ˆëŠ”ë°ìš”
ì¢…ëŒ€: ê±°ì§“ë§í•˜ì§€ ë§ˆë¼
ëŒ€ë²ˆ: ì§„ì§œë¼ë‹ˆê¹Œìš”
</textarea>

</div>

<div class="display" id="display">
&lt;ìƒëŒ€ ëŒ€ì‚¬&gt;
</div>

<div class="gauge">
<div class="gaugeBar" id="gaugeBar"></div>
</div>

<div class="centerBox">
<button class="grayBtn" onclick="startPractice()">ì—°ìŠµ ì‹œì‘</button>
</div>

<div class="centerBox">
<button class="grayBtn" onclick="showMyLine()">ë‚´ ëŒ€ì‚¬ ë³´ê¸°</button>
</div>

<div class="row">
<button class="yellowBtn" onclick="prevLine()">ì´ì „</button>
<button class="yellowBtn" onclick="nextLine()">ë‹¤ìŒ</button>
</div>

<div class="centerBox">
<button id="autoBtn" class="autoOff" onclick="toggleAuto()">
ìë™ì—°ìŠµ OFF
</button>
</div>

<br>

<button class="small" onclick="saveScript()">ğŸ’¾ ì €ì¥</button>
<button class="small" onclick="loadScript()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>

<br><br>

ì—°ìŠµíšŸìˆ˜:
<span id="count">0</span>

</div>

<script>

let lines=[];
let index=0;
let role="";
let autoMode=false;
let practiceCount=0;
let timer=null;

const synth=window.speechSynthesis;

function parseScript(){
    role=document.getElementById("roleInput").value.trim();

    lines=document.getElementById("scriptInput").value
    .split("\n")
    .map(l=>{
        let p=l.split(":");
        return {
            role:p[0]?.trim(),
            text:p[1]?.trim()
        };
    });
}

function getKoreanVoice(type){

    let voices=synth.getVoices();

    let koreanVoices=voices.filter(v=>v.lang.includes("ko"));

    if(koreanVoices.length===0) return voices[0];

    if(type==="male"){
        return koreanVoices[0];
    }else{
        return koreanVoices[1] || koreanVoices[0];
    }
}

function speak(text,callback){

    let utter=new SpeechSynthesisUtterance(text);

    let type=document.getElementById("voiceSelect").value;

    utter.voice=getKoreanVoice(type);

    utter.rate=parseFloat(document.getElementById("speed").value)/2.5;

    utter.onend=callback;

    synth.speak(utter);
}

function showLine(){

    if(index<0)index=0;
    if(index>=lines.length)index=0;

    let line=lines[index];

    if(line.role===role){
        document.getElementById("display").innerText="<ë‚´ ì°¨ë¡€>";
    }else{
        document.getElementById("display").innerText=line.text;
        speak(line.text,()=>{
            if(autoMode)autoNext();
        });
    }
}

function nextLine(){
    index++;
    showLine();
}

function prevLine(){
    index--;
    showLine();
}

function showMyLine(){
    let line=lines[index];
    if(line.role===role){
        document.getElementById("display").innerText=line.text;
    }
}

function startPractice(){
    parseScript();
    index=0;
    practiceCount=0;
    document.getElementById("count").innerText=0;
    showLine();
}

function toggleAuto(){

    autoMode=!autoMode;

    let btn=document.getElementById("autoBtn");

    if(autoMode){
        btn.className="autoOn";
        btn.innerText="ìë™ì—°ìŠµ ON";
        startPractice();
    }else{
        btn.className="autoOff";
        btn.innerText="ìë™ì—°ìŠµ OFF";
        stopAuto();
    }
}

function stopAuto(){
    autoMode=false;
    clearInterval(timer);
    synth.cancel();
    document.getElementById("display").innerText="<ìƒëŒ€ ëŒ€ì‚¬>";
    document.getElementById("gaugeBar").style.width="100%";
}

function autoNext(){

    if(!autoMode)return;

    index++;

    if(index>=lines.length){
        index=0;
        practiceCount++;
        document.getElementById("count").innerText=practiceCount;
    }

    let line=lines[index];

    if(line.role===role){

        let duration=(line.text.length*80)+2000;

        startGauge(duration);

        setTimeout(()=>{
            autoNext();
        },duration);

    }else{
        showLine();
    }
}

function startGauge(duration){

    let bar=document.getElementById("gaugeBar");
    let start=Date.now();

    timer=setInterval(()=>{

        let p=100-((Date.now()-start)/duration)*100;

        bar.style.width=p+"%";

        if(p<=0){
            clearInterval(timer);
        }

    },50);
}

function saveScript(){

    localStorage.setItem("script",
        document.getElementById("scriptInput").value);

    localStorage.setItem("role",
        document.getElementById("roleInput").value);

    alert("ì €ì¥ë¨");
}

function loadScript(){

    document.getElementById("scriptInput").value=
        localStorage.getItem("script")||"";

    document.getElementById("roleInput").value=
        localStorage.getItem("role")||"";

    alert("ë¶ˆëŸ¬ì˜´");
}

document.getElementById("speed").oninput=function(){
    document.getElementById("speedVal").innerText=this.value;
}

</script>

</body>
</html>
