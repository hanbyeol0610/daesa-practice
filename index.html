<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>대본연습</title>

<style>

body{
    margin:0;
    background:#111;
    color:white;
    font-family: 'Courier New', monospace;
}

.container{
    max-width:800px;
    margin:auto;
    padding:20px;
}

.banner{
    width:100%;
    margin-bottom:20px;
    border:2px solid #333;
}

.title{
    text-align:center;
    font-size:28px;
    letter-spacing:4px;
    margin-bottom:20px;
}

.scriptBox{
    background:#000;
    border:2px solid #333;
    padding:30px;
    font-size:28px;
    min-height:140px;
    text-align:center;
    line-height:1.5;
}

.myLine{
    margin-top:10px;
    padding:20px;
    border:1px dashed #777;
    font-size:24px;
    display:none;
    color:#ccc;
}

.controls{
    margin-top:20px;
}

button{
    font-size:22px;
    padding:15px;
    margin-top:10px;
    width:100%;
    background:#222;
    color:white;
    border:1px solid #555;
}

.bigBtn{
    font-size:28px;
    padding:25px;
    background:#e0b000;
    color:black;
    font-weight:bold;
}

textarea{
    width:100%;
    height:150px;
    background:#000;
    color:#ccc;
    border:1px solid #444;
    margin-top:10px;
    font-size:16px;
}

input{
    width:100%;
    padding:15px;
    background:#000;
    color:white;
    border:1px solid #444;
    margin-top:10px;
    font-size:18px;
}

.counter{
    text-align:center;
    margin:15px 0;
    font-size:20px;
    color:#aaa;
}

</style>

</head>

<body>

<div class="container">

<img src="banner.png" class="banner">

<div class="title">
SCRIPT PRACTICE
</div>

<input id="myRole" placeholder="내 역할 이름 입력">

<div class="counter" id="counter">
0번 연습
</div>

<textarea id="scriptInput">
종대: 니 왔나
판수: 왔다
종대: 늦었다
판수: 미안하다
</textarea>

<div class="scriptBox" id="otherLine">
연습 시작
</div>

<div class="myLine" id="myLine"></div>

<div class="controls">

<button onclick="startPractice()">연습 시작</button>

<button onclick="showMyLine()">내 대사 보기</button>

<button class="bigBtn" onclick="prevLine()">◀ 이전</button>

<button class="bigBtn" onclick="nextLine()">다음 ▶</button>

</div>

</div>

<script>

let lines = [];
let index = -1;
let myLineText = "";
let myRole = "";
let repeatCount = 0;

function parseScript(){
    let text = document.getElementById("scriptInput").value;
    lines = text.split("\n");
}

function speak(text){

    speechSynthesis.cancel();

    const utter = new SpeechSynthesisUtterance(text);

    utter.lang = "ko-KR";
    utter.rate = 0.95;
    utter.pitch = 0.9;

    speechSynthesis.speak(utter);
}

function startPractice(){

    parseScript();

    myRole = document.getElementById("myRole").value.trim();

    if(myRole === ""){
        alert("역할 이름 입력");
        return;
    }

    repeatCount++;
    document.getElementById("counter").innerText = repeatCount + "번 연습";

    index = -1;

    nextLine();
}

function nextLine(){

    document.getElementById("myLine").style.display="none";

    for(let i=0;i<lines.length;i++){

        index++;

        if(index >= lines.length){
            index = 0;
        }

        let line = lines[index];

        if(!line.includes(":")) continue;

        let role = line.split(":")[0].trim();
        let text = line.split(":")[1].trim();

        if(role !== myRole){

            document.getElementById("otherLine").innerText = text;

            myLineText = "";
            speak(text);

            return;
        }
        else{
            myLineText = text;
        }

    }

}

function prevLine(){

    document.getElementById("myLine").style.display="none";

    for(let i=0;i<lines.length;i++){

        index--;

        if(index < 0){
            index = lines.length-1;
        }

        let line = lines[index];

        if(!line.includes(":")) continue;

        let role = line.split(":")[0].trim();
        let text = line.split(":")[1].trim();

        if(role !== myRole){

            document.getElementById("otherLine").innerText = text;

            myLineText = "";
            speak(text);

            return;
        }
        else{
            myLineText = text;
        }

    }

}

function showMyLine(){

    if(myLineText === "") return;

    document.getElementById("myLine").innerText = myLineText;
    document.getElementById("myLine").style.display="block";
}

</script>

</body>
</html>
