<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëŒ€ì‚¬ì—°ìŠµ</title>

<style>
body {
    background-color: #111;
    color: white;
    font-family: sans-serif;
    padding: 20px;
}

h1 {
    text-align: center;
}

.container {
    background: #1e1e1e;
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 20px;
}

input, textarea, select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: none;
    background: #333;
    color: white;
    font-size: 16px;
}

button {
    width: 100%;
    padding: 15px;
    margin-top: 10px;
    border-radius: 10px;
    border: none;
    font-size: 18px;
    background: #007AFF;
    color: white;
}

button.secondary {
    background: #444;
}

.dialogBox {
    background: #222;
    padding: 15px;
    border-radius: 10px;
    margin-top: 10px;
    font-size: 18px;
    min-height: 60px;
}

.myLine {
    color: #00ff88;
    margin-top: 10px;
}
</style>
</head>

<body>

<h1>ğŸ­ ëŒ€ì‚¬ì—°ìŠµ</h1>

<div class="container">

<label>ë‚´ ë°°ì—­</label>
<input id="myRole" placeholder="ì˜ˆ: ì¡°íŒìˆ˜">

<label>ëª©ì†Œë¦¬ ì„ íƒ</label>
<select id="voiceSelect">
<option value="male">ë‚¨ì</option>
<option value="female">ì—¬ì</option>
</select>

<label>ëŒ€ì‚¬ ì†ë„: <span id="speedValue">1</span></label>
<input type="range" id="speedControl" min="0.5" max="2" step="0.1" value="1">

</div>

<div class="container">

<label>ëŒ€ë³¸ ì…ë ¥ (ë°°ì—­:ëŒ€ì‚¬ í˜•ì‹)</label>
<textarea id="scriptInput" rows="10" placeholder="ì¡°íŒìˆ˜: ì „í™” ì™œ ì•ˆ ë°›ì•˜ì–´?
ì´ê°•í¬: ë°”ë¹´ì–´
ì¡°íŒìˆ˜: ë‹¤ìŒë¶€í„°ëŠ” ë°›ì•„"></textarea>

</div>

<div class="container">

<button onclick="startPractice()">ğŸ¬ ì—°ìŠµ ì‹œì‘</button>
<button onclick="prevLine()" class="secondary">â¬… ì´ì „</button>
<button onclick="nextLine()">â¡ ë‹¤ìŒ</button>
<button onclick="speak()">ğŸ”Š ìƒëŒ€ ëŒ€ì‚¬</button>
<button onclick="showMyLine()" class="secondary">ğŸ“– ë‚´ ëŒ€ì‚¬</button>

</div>

<div class="container">

<div>ğŸ­ ìƒëŒ€ ëŒ€ì‚¬</div>
<div id="otherDisplay" class="dialogBox"></div>

<div id="myDisplay" class="myLine"></div>

</div>

<script>

let script = [];
let currentIndex = -1;
let myRole = "";

const speedControl = document.getElementById("speedControl");
const speedValue = document.getElementById("speedValue");

speedControl.addEventListener("input", () => {
    speedValue.textContent = speedControl.value;
});

function parseScript() {
    const text = document.getElementById("scriptInput").value;
    const lines = text.split("\n");

    script = [];

    lines.forEach(line => {
        const parts = line.split(":");
        if(parts.length >= 2){
            script.push({
                role: parts[0].trim(),
                line: parts.slice(1).join(":").trim()
            });
        }
    });
}

function startPractice() {
    parseScript();
    myRole = document.getElementById("myRole").value.trim();
    currentIndex = -1;
    nextLine();
}

function nextLine() {
    for(let i = currentIndex + 1; i < script.length; i++) {
        if(script[i].role !== myRole){
            currentIndex = i;
            showLine();
            return;
        }
    }
}

function prevLine() {
    for(let i = currentIndex - 1; i >= 0; i--) {
        if(script[i].role !== myRole){
            currentIndex = i;
            showLine();
            return;
        }
    }
}

function showLine() {
    document.getElementById("otherDisplay").innerText =
        script[currentIndex].role + ": " + script[currentIndex].line;

    document.getElementById("myDisplay").innerText = "";
}

function showMyLine() {

    for(let i = currentIndex + 1; i < script.length; i++) {
        if(script[i].role === myRole){
            document.getElementById("myDisplay").innerText =
                myRole + ": " + script[i].line;
            return;
        }
    }
}

function speak() {

    const text = script[currentIndex].line;
    const speed = parseFloat(speedControl.value);
    const voiceType = document.getElementById("voiceSelect").value;

    speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);

    utterance.rate = speed;
    utterance.lang = "ko-KR";

    const voices = speechSynthesis.getVoices();

    if (voiceType === "female") {
        utterance.voice = voices.find(v => v.name.includes("Female")) || voices[0];
    } else {
        utterance.voice = voices.find(v => v.name.includes("Male")) || voices[0];
    }

    speechSynthesis.speak(utterance);
}

</script>

</body>
</html>
