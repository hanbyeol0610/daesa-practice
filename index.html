<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>대본 연습</title>

<style>
body{
margin:0;
background:#1a1a1a;
color:white;
font-family:Arial;
}

/* 배너 */
.banner{
width:100%;
max-width:900px;
margin:0 auto 20px auto;
border-radius:10px;
overflow:hidden;
}

.banner img{
width:100%;
height:auto;
display:block;
}

.container{
max-width:900px;
margin:auto;
padding:20px;
}

.section{
background:#2a2a2a;
padding:15px;
border-radius:10px;
margin-bottom:15px;
}

.scriptBox{
background:#f5f5f5;
color:black;
padding:20px;
border-radius:10px;
margin-bottom:15px;
}

textarea{
width:100%;
height:260px;
font-size:16px;
}

.display{
background:#111;
padding:20px;
border-radius:10px;
min-height:70px;
margin-bottom:10px;
font-size:20px;
}

.gauge{
height:14px;
background:#333;
margin-top:10px;
border-radius:6px;
overflow:hidden;
}

.gaugeBar{
height:100%;
width:100%;
background:gold;
}

.fullBtn{
width:100%;
background:#777;
color:white;
font-size:26px;
padding:18px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
}

.pauseBtn{
width:100%;
background:#c0392b;
color:white;
font-size:22px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
display:none;
}

.resumeBtn{
width:100%;
background:#27ae60;
color:white;
font-size:22px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
margin-bottom:10px;
display:none;
}

.row{
display:flex;
gap:10px;
}

.yellowBtn{
background:gold;
color:black;
font-size:20px;
padding:15px;
border:none;
border-radius:8px;
cursor:pointer;
flex:1;
}

.autoOff{
background:red;
color:white;
flex:1;
}

.autoOn{
background:green;
color:white;
flex:1;
}

</style>
</head>

<body>

<div class="banner">
<img src="banner.png">
</div>

<div class="container">

<div class="section">
역할:
<input id="roleInput">

<br><br>

음성:
<select id="voiceSelect">
<option value="male" selected>남자</option>
<option value="female">여자</option>
</select>

속도:
<input type="range" min="0" max="5" step="0.1" value="2.5" id="speed">
<span id="speedVal">2.5</span>

</div>

<div class="scriptBox">
<textarea id="scriptInput">
종대: 니 지금 뭐하냐?!
한별: 아무것도 안했는데요
종대: 거짓말하지 마라
한별: 거짓말?! 나보다 어려 보이는 고만..확!
</textarea>
</div>

<div class="display" id="display">
&lt;상대 대사&gt;
</div>

<div class="gauge">
<div class="gaugeBar" id="gaugeBar"></div>
</div>

<button class="fullBtn" onclick="startPractice()">연습 시작</button>

<button id="pauseBtn" class="pauseBtn" onclick="pauseAuto()">⏸ 일시정지</button>
<button id="resumeBtn" class="resumeBtn" onclick="resumeAuto()">▶ 다시하기</button>

<div class="row">
<button class="yellowBtn" onclick="prevLine()">이전</button>
<button id="autoBtn" class="autoOff" onclick="toggleAuto()">자동연습 OFF</button>
<button class="yellowBtn" onclick="nextLine()">다음</button>
</div>

</div>

<script>

let lines=[];
let index=0;
let role="";

let autoMode=false;
let paused=false;

let autoTimer=null;
let gaugeTimer=null;

let totalDuration=0;
let remainingTime=0;

let gaugeStartPercent=100;
let pausedPercent=100;

const synth=window.speechSynthesis;

function parseScript(){
role=document.getElementById("roleInput").value.trim();
lines=document.getElementById("scriptInput").value
.split("\n")
.map(l=>{
let p=l.split(":");
return {role:p[0]?.trim(),text:p[1]?.trim()};
});
}

function showLine(){

let line=lines[index];

if(line.role===role){
document.getElementById("display").innerText="<내 차례>";
if(autoMode && !paused) autoNext();
}else{
document.getElementById("display").innerText=line.text;
if(autoMode && !paused){
setTimeout(autoNext,1000);
}
}

}

function nextLine(){
do{
index++;
if(index>=lines.length) index=0;
}while(lines[index].role===role);
showLine();
}

function prevLine(){
do{
index--;
if(index<0) index=lines.length-1;
}while(lines[index].role===role);
showLine();
}

function startPractice(){
parseScript();
index=0;
showLine();
}

function toggleAuto(){

autoMode=!autoMode;

if(autoMode){
document.getElementById("autoBtn").className="autoOn";
document.getElementById("pauseBtn").style.display="block";
startPractice();
}else{
stopAuto();
}

}

function pauseAuto(){

paused=true;

clearTimeout(autoTimer);
clearInterval(gaugeTimer);

pausedPercent = parseFloat(
document.getElementById("gaugeBar").style.width
);

document.getElementById("pauseBtn").style.display="none";
document.getElementById("resumeBtn").style.display="block";

}

function resumeAuto(){

paused=false;

startGaugeRemaining(pausedPercent);

remainingTime = totalDuration * (pausedPercent/100);

autoTimer=setTimeout(autoNext,remainingTime);

document.getElementById("pauseBtn").style.display="block";
document.getElementById("resumeBtn").style.display="none";

}

function stopAuto(){

autoMode=false;
paused=false;

clearTimeout(autoTimer);
clearInterval(gaugeTimer);

document.getElementById("pauseBtn").style.display="none";
document.getElementById("resumeBtn").style.display="none";

document.getElementById("gaugeBar").style.width="100%";

}

function autoNext(){

if(!autoMode || paused) return;

index++;

if(index>=lines.length){
stopAuto();
return;
}

let line=lines[index];

if(line.role===role){

let duration=(line.text.length*80)+6000;

totalDuration=duration;

startGauge(duration);

autoTimer=setTimeout(autoNext,duration);

}else{

showLine();

}

}

function startGauge(duration){

let bar=document.getElementById("gaugeBar");
let start=Date.now();

clearInterval(gaugeTimer);

gaugeTimer=setInterval(()=>{

let p=100-((Date.now()-start)/duration)*100;
bar.style.width=p+"%";

if(p<=0){
clearInterval(gaugeTimer);
}

},50);

}

function startGaugeRemaining(startPercent){

let bar=document.getElementById("gaugeBar");
let start=Date.now();

clearInterval(gaugeTimer);

gaugeTimer=setInterval(()=>{

let elapsed=(Date.now()-start);
let duration=totalDuration*(startPercent/100);

let p=startPercent-(elapsed/duration)*startPercent;

bar.style.width=p+"%";

if(p<=0){
clearInterval(gaugeTimer);
}

},50);

}

</script>

</body>
</html>
