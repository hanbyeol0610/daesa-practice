<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ëŒ€ì‚¬ ì—°ìŠµ</title>

<style>

body{
    margin:0;
    background:#1a1a1a;
    color:white;
    font-family:serif;
}

.banner{
    width:100%;
    height:140px;
    background:url("banner.jpg") center/cover no-repeat;
}

.container{
    max-width:900px;
    margin:auto;
    padding:20px;
}

.scriptBox{
    background:#f5f5f5;
    color:black;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
}

textarea{
    width:100%;
    height:200px;
    font-size:16px;
    background:white;
    color:black;
}

.display{
    background:#111;
    padding:15px;
    border-radius:10px;
    min-height:60px;
    margin-bottom:10px;
}

.buttons{
    display:flex;
    justify-content:space-between;
    margin-top:10px;
}

button{
    padding:10px 20px;
    font-size:18px;
    border:none;
    border-radius:8px;
    cursor:pointer;
}

.bigBtn{
    font-size:22px;
    padding:12px 30px;
}

.gauge{
    height:12px;
    background:#333;
    margin-top:10px;
    border-radius:6px;
    overflow:hidden;
}

.gaugeBar{
    height:100%;
    width:100%;
    background:gold;
}

.smallBtns{
    margin-top:10px;
    display:flex;
    gap:10px;
}

</style>
</head>

<body>

<div class="banner"></div>

<div class="container">

<div class="scriptBox">
ì—­í• :
<input id="roleInput" placeholder="ì˜ˆ: ì¢…ëŒ€">

ëŒ€ë³¸:
<textarea id="scriptInput">
ì¢…ëŒ€: ë‹ˆ ì§€ê¸ˆ ë­í•˜ë…¸
ëŒ€ë²ˆ: ì•„ë¬´ê²ƒë„ ì•ˆí–ˆëŠ”ë°ìš”
ì¢…ëŒ€: ê±°ì§“ë§í•˜ì§€ ë§ˆë¼
ëŒ€ë²ˆ: ì§„ì§œë¼ë‹ˆê¹Œìš”
</textarea>
</div>

<div class="display" id="display">
&lt;ìƒëŒ€ ëŒ€ì‚¬&gt;
</div>

<div class="gauge">
<div class="gaugeBar" id="gaugeBar"></div>
</div>

<div class="buttons">
<button class="bigBtn" onclick="prevLine()">ì´ì „</button>
<button class="bigBtn" onclick="nextLine()">ë‹¤ìŒ</button>
</div>

<div class="smallBtns">
<button onclick="startPractice()">ì—°ìŠµ ì‹œì‘</button>
<button onclick="showMyLine()">ë‚´ ëŒ€ì‚¬ ë³´ê¸°</button>
<button onclick="toggleAuto()">ìë™ì—°ìŠµ</button>
<button onclick="saveScript()">ğŸ’¾</button>
<button onclick="loadScript()">ğŸ“‚</button>
</div>

ì—°ìŠµíšŸìˆ˜: <span id="count">0</span>ë²ˆ

</div>

<script>

let lines = [];
let index = 0;
let role = "";
let autoMode = false;
let practiceCount = 0;

const synth = window.speechSynthesis;

function parseScript(){
    const text = document.getElementById("scriptInput").value;
    role = document.getElementById("roleInput").value.trim();
    
    lines = text.split("\n").map(line=>{
        let parts = line.split(":");
        return {
            role:parts[0]?.trim(),
            text:parts[1]?.trim()
        };
    });
}

function speak(text, callback){
    let utter = new SpeechSynthesisUtterance(text);
    utter.rate = speechRate;
    utter.onend = callback;
    synth.speak(utter);
}

let speechRate = 1.0;

function nextLine(){
    parseScript();
    index++;
    if(index>=lines.length){
        index=0;
        practiceCount++;
        document.getElementById("count").innerText=practiceCount;
    }
    showLine();
}

function prevLine(){
    parseScript();
    index--;
    if(index<0) index=0;
    showLine();
}

function showLine(){
    let line = lines[index];
    
    if(line.role===role){
        document.getElementById("display").innerText="<ë‚´ ì°¨ë¡€>";
    }else{
        document.getElementById("display").innerText=line.text;
        speak(line.text,()=>{
            if(autoMode) autoNext();
        });
    }
}

function showMyLine(){
    let line = lines[index];
    if(line.role===role){
        document.getElementById("display").innerText=line.text;
    }
}

function startPractice(){
    parseScript();
    index=0;
    practiceCount=0;
    document.getElementById("count").innerText=0;
    showLine();
}

function toggleAuto(){
    autoMode=!autoMode;
    
    if(autoMode){
        startPractice();
    }
}

function autoNext(){
    index++;
    if(index>=lines.length){
        index=0;
        practiceCount++;
        document.getElementById("count").innerText=practiceCount;
    }
    
    let line = lines[index];
    
    if(line.role===role){
        let duration = (line.text.length * 80)+2000;
        startGauge(duration);
        
        setTimeout(()=>{
            autoNext();
        },duration);
        
    }else{
        showLine();
    }
}

function startGauge(duration){
    let bar = document.getElementById("gaugeBar");
    bar.style.width="100%";
    
    let start = Date.now();
    
    let timer = setInterval(()=>{
        let now = Date.now();
        let percent = 100 - ((now-start)/duration)*100;
        bar.style.width=percent+"%";
        
        if(percent<=0){
            clearInterval(timer);
        }
    },50);
}

function saveScript(){
    localStorage.setItem("script",document.getElementById("scriptInput").value);
    localStorage.setItem("role",document.getElementById("roleInput").value);
}

function loadScript(){
    document.getElementById("scriptInput").value=
        localStorage.getItem("script")||"";
        
    document.getElementById("roleInput").value=
        localStorage.getItem("role")||"";
}

</script>

</body>
</html>
